<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Speak - –ò–∑—É—á–µ–Ω–∏–µ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        
        const EnglishSpeakApp = () => {
          // –ü—Ä–æ—Å—Ç—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
          const [currentPhrase, setCurrentPhrase] = useState(null);
          const [showTranslation, setShowTranslation] = useState(false);
          const [textInput, setTextInput] = useState('');
          const [isRecording, setIsRecording] = useState(false);
          const [messages, setMessages] = useState([]);
          
          // Refs
          const recognitionRef = useRef(null);
          const synthRef = useRef(null);

          // –§—Ä–∞–∑—ã —É—Ä–æ–≤–Ω—è B1
          const phrases = [
            { en: "I have been studying English for two years", ru: "–Ø –∏–∑—É—á–∞—é –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —É–∂–µ –¥–≤–∞ –≥–æ–¥–∞" },
            { en: "If I were you, I would try harder", ru: "–ù–∞ –≤–∞—à–µ–º –º–µ—Å—Ç–µ —è –±—ã –±–æ–ª—å—à–µ —Å—Ç–∞—Ä–∞–ª—Å—è" },
            { en: "I'm looking forward to hearing from you", ru: "–ñ–¥—É –≤–∞—à–µ–≥–æ –æ—Ç–≤–µ—Ç–∞" },
            { en: "Could you please explain this again?", ru: "–ù–µ –º–æ–≥–ª–∏ –±—ã –≤—ã –æ–±—ä—è—Å–Ω–∏—Ç—å —ç—Ç–æ –µ—â–µ —Ä–∞–∑?" },
            { en: "I'm not sure what you mean", ru: "–Ø –Ω–µ —É–≤–µ—Ä–µ–Ω, —á—Ç–æ –≤—ã –∏–º–µ–µ—Ç–µ –≤ –≤–∏–¥—É" },
            { en: "What do you think about this idea?", ru: "–ß—Ç–æ –≤—ã –¥—É–º–∞–µ—Ç–µ –æ–± —ç—Ç–æ–π –∏–¥–µ–µ?" },
            { en: "I completely agree with you", ru: "–Ø –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å –≤–∞–º–∏ —Å–æ–≥–ª–∞—Å–µ–Ω" },
            { en: "That's an interesting point of view", ru: "–≠—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è —Ç–æ—á–∫–∞ –∑—Ä–µ–Ω–∏—è" },
            { en: "I'd like to make a suggestion", ru: "–Ø —Ö–æ—Ç–µ–ª –±—ã –≤–Ω–µ—Å—Ç–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ" },
            { en: "Could we schedule a meeting for next week?", ru: "–ù–µ –º–æ–≥–ª–∏ –±—ã –º—ã –Ω–∞–∑–Ω–∞—á–∏—Ç—å –≤—Å—Ç—Ä–µ—á—É –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –Ω–µ–¥–µ–ª—é?" }
          ];

          // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
          useEffect(() => {
            // –ü–æ–ª—É—á–∞–µ–º –ø–µ—Ä–≤—É—é —Ñ—Ä–∞–∑—É
            getNewPhrase();
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏–Ω—Ç–µ–∑–∞ —Ä–µ—á–∏
            if ('speechSynthesis' in window) {
              synthRef.current = window.speechSynthesis;
            }

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
              const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
              const recognition = new SpeechRecognition();
              
              recognition.continuous = false;
              recognition.interimResults = false;
              recognition.lang = 'en-US';
              recognition.maxAlternatives = 1;
              
              recognition.onstart = () => {
                console.log('Speech recognition started');
                setIsRecording(true);
              };
              
              recognition.onresult = (event) => {
                console.log('Speech recognition result:', event);
                if (event.results && event.results.length > 0) {
                  const transcript = event.results[0][0].transcript;
                  console.log('Recognized text:', transcript);
                  setTextInput(transcript);
                } else {
                  console.log('No speech results');
                }
              };
              
              recognition.onend = () => {
                console.log('Speech recognition ended');
                setIsRecording(false);
              };
              
              recognition.onerror = (event) => {
                console.error('Speech recognition error:', event);
                setIsRecording(false);
                
                let errorMessage = 'Microphone error: ';
                switch(event.error) {
                  case 'no-speech':
                    errorMessage += 'No speech detected. Please try again.';
                    break;
                  case 'audio-capture':
                    errorMessage += 'No microphone found.';
                    break;
                  case 'not-allowed':
                    errorMessage += 'Microphone access denied.';
                    break;
                  case 'network':
                    errorMessage += 'Network error occurred.';
                    break;
                  default:
                    errorMessage += event.error;
                }
                alert(errorMessage);
              };
              
              recognitionRef.current = recognition;
              console.log('Speech recognition initialized successfully');
            } else {
              console.log('Speech recognition not supported in this browser');
            }
          }, []);

          // –ü–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—É—é —Ñ—Ä–∞–∑—É
          const getNewPhrase = () => {
            const randomIndex = Math.floor(Math.random() * phrases.length);
            setCurrentPhrase(phrases[randomIndex]);
            setShowTranslation(false);
          };

          // –û–∑–≤—É—á–∏—Ç—å —Ñ—Ä–∞–∑—É
          const speakPhrase = () => {
            if (synthRef.current && currentPhrase) {
              synthRef.current.cancel();
              const utterance = new SpeechSynthesisUtterance(currentPhrase.en);
              utterance.lang = 'en-US';
              utterance.rate = 0.8;
              synthRef.current.speak(utterance);
            }
          };

          // –ó–∞–ø—É—Å–∫ –∑–∞–ø–∏—Å–∏
          const startRecording = async () => {
            console.log('–ü–æ–ø—ã—Ç–∫–∞ –∑–∞–ø—É—Å–∫–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞...');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É –±—Ä–∞—É–∑–µ—Ä–∞
            if (!recognitionRef.current) {
              alert('Speech recognition not supported. Please use Chrome browser.');
              return;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –ª–∏ —É–∂–µ
            if (isRecording) {
              console.log('Already recording, stopping...');
              recognitionRef.current.stop();
              return;
            }

            try {
              // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω
              console.log('Requesting microphone permission...');
              const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
              console.log('Microphone permission granted');
              
              // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ—Ç–æ–∫ (–Ω–∞–º –Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ)
              stream.getTracks().forEach(track => track.stop());
              
              // –ó–∞–ø—É—Å–∫–∞–µ–º —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ
              console.log('Starting speech recognition...');
              recognitionRef.current.start();
              
            } catch (error) {
              console.error('Microphone error:', error);
              if (error.name === 'NotAllowedError') {
                alert('Microphone access denied. Please allow microphone access in browser settings.');
              } else if (error.name === 'NotFoundError') {
                alert('No microphone found. Please connect a microphone.');
              } else {
                alert('Microphone error: ' + error.message);
              }
              setIsRecording(false);
            }
          };

          // –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
          const sendMessage = () => {
            if (textInput.trim() && currentPhrase) {
              const newMessage = {
                text: textInput.trim(),
                phrase: currentPhrase,
                time: new Date().toLocaleTimeString(),
                date: new Date().toLocaleDateString()
              };
              
              const updatedMessages = [...messages, newMessage];
              setMessages(updatedMessages);
              
              setTextInput('');
              
              // –ù–æ–≤–∞—è —Ñ—Ä–∞–∑–∞ —á–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É
              setTimeout(getNewPhrase, 1000);
            }
          };

          // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è Enter
          const handleKeyDown = (e) => {
            if (e.key === 'Enter') {
              sendMessage();
            }
          };

          return React.createElement('div', { className: "min-h-screen bg-gray-100 p-4" },
            React.createElement('div', { className: "max-w-4xl mx-auto" },
              
              // –ó–∞–≥–æ–ª–æ–≤–æ–∫
              React.createElement('div', { className: "bg-white rounded-lg shadow-lg p-6 mb-6" },
                React.createElement('h1', { className: "text-3xl font-bold text-gray-800 mb-2" }, "English Speak"),
                React.createElement('p', { className: "text-gray-600" }, 
                  "–£—Ä–æ–≤–µ–Ω—å: ", 
                  React.createElement('span', { className: "font-semibold text-blue-600" }, "B1")
                )
              ),

              // –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞
              React.createElement('div', { className: "bg-white rounded-lg shadow-lg p-6 mb-6" },
                React.createElement('h3', { className: "font-semibold text-gray-800 mb-4" }, "üé§ Microphone Test & Info:"),
                
                React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-4 text-sm" },
                  React.createElement('div', null,
                    React.createElement('strong', null, "Browser Support:"),
                    React.createElement('br'),
                    "Speech Recognition: ", ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) ? '‚úÖ Supported' : '‚ùå Not Supported',
                    React.createElement('br'),
                    "MediaDevices API: ", ('mediaDevices' in navigator) ? '‚úÖ Supported' : '‚ùå Not Supported'
                  ),
                  React.createElement('div', null,
                    React.createElement('strong', null, "Recording Status:"),
                    React.createElement('br'),
                    "Currently Recording: ", isRecording ? 'üî¥ YES' : '‚ö™ NO',
                    React.createElement('br'),
                    "Recognition Object: ", recognitionRef.current ? '‚úÖ Ready' : '‚ùå Not Ready'
                  )
                ),
                
                React.createElement('button', {
                  onClick: () => {
                    console.log('Testing microphone access...');
                    navigator.mediaDevices.getUserMedia({ audio: true })
                      .then(stream => {
                        alert('‚úÖ Microphone access works! You can use voice input.');
                        stream.getTracks().forEach(track => track.stop());
                      })
                      .catch(error => {
                        alert('‚ùå Microphone test failed: ' + error.message);
                      });
                  },
                  className: "mt-4 bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600 transition-colors"
                }, "Test Microphone Access")
              ),

              // –¢–µ–∫—É—â–∞—è —Ñ—Ä–∞–∑–∞
              currentPhrase && React.createElement('div', { className: "bg-blue-50 rounded-lg p-6 mb-6" },
                React.createElement('div', { className: "flex justify-between items-center mb-4" },
                  React.createElement('h2', { className: "text-xl font-semibold text-gray-800" }, "–ò–∑—É—á–∞–µ–º —Ñ—Ä–∞–∑—É:"),
                  React.createElement('button', {
                    onClick: speakPhrase,
                    className: "bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700 transition-colors"
                  }, "üîä")
                ),
                
                React.createElement('div', { className: "text-lg font-medium text-blue-800 mb-3" }, currentPhrase.en),
                
                React.createElement('button', {
                  onClick: () => setShowTranslation(!showTranslation),
                  className: "text-blue-600 hover:text-blue-800 underline text-sm"
                }, showTranslation ? '–°–∫—Ä—ã—Ç—å –ø–µ—Ä–µ–≤–æ–¥' : '–ü–æ–∫–∞–∑–∞—Ç—å –ø–µ—Ä–µ–≤–æ–¥'),
                
                showTranslation && React.createElement('div', { className: "text-gray-600 mt-2 italic" }, currentPhrase.ru)
              ),

              // –ü–æ–ª–µ –≤–≤–æ–¥–∞
              React.createElement('div', { className: "bg-white rounded-lg shadow-lg p-6 mb-6" },
                React.createElement('h3', { className: "font-semibold text-gray-800 mb-4" }, "–í–∞—à –æ—Ç–≤–µ—Ç:"),
                
                // –ü—Ä–æ—Å—Ç–æ–µ –ø–æ–ª–µ –≤–≤–æ–¥–∞
                React.createElement('div', { className: "mb-4" },
                  React.createElement('input', {
                    type: "text",
                    value: textInput,
                    onChange: (e) => setTextInput(e.target.value),
                    onKeyDown: handleKeyDown,
                    placeholder: "–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –æ—Ç–≤–µ—Ç –∑–¥–µ—Å—å...",
                    className: "w-full p-4 text-lg border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"
                  })
                ),

                // –ö–Ω–æ–ø–∫–∏
                React.createElement('div', { className: "flex flex-wrap gap-3" },
                  React.createElement('button', {
                    onClick: startRecording,
                    disabled: isRecording,
                    className: `flex items-center gap-2 px-6 py-3 rounded-lg font-medium transition-colors ${
                      isRecording 
                        ? 'bg-red-500 text-white animate-pulse cursor-not-allowed' 
                        : 'bg-green-500 text-white hover:bg-green-600'
                    }`
                  }, "üé§ ", isRecording ? '–ó–∞–ø–∏—Å—ã–≤–∞—é...' : '–ó–∞–ø–∏—Å–∞—Ç—å –≥–æ–ª–æ—Å'),
                  
                  React.createElement('button', {
                    onClick: sendMessage,
                    disabled: !textInput.trim(),
                    className: `flex items-center gap-2 px-6 py-3 rounded-lg font-medium transition-colors ${
                      textInput.trim() 
                        ? 'bg-blue-600 text-white hover:bg-blue-700' 
                        : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                    }`
                  }, "üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å"),
                  
                  React.createElement('button', {
                    onClick: getNewPhrase,
                    className: "flex items-center gap-2 px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors"
                  }, "üîÑ –ù–æ–≤–∞—è —Ñ—Ä–∞–∑–∞"),
                  
                  React.createElement('button', {
                    onClick: () => {
                      setMessages([]);
                      alert('–ò—Å—Ç–æ—Ä–∏—è –æ—á–∏—â–µ–Ω–∞!');
                    },
                    className: "flex items-center gap-2 px-6 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors"
                  }, "üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é")
                ),

                // –°—Ç–∞—Ç—É—Å –∑–∞–ø–∏—Å–∏
                isRecording && React.createElement('div', { className: "mt-4 p-4 bg-red-50 border-2 border-red-200 rounded-lg text-center" },
                  React.createElement('div', { className: "text-red-700 font-bold" }, "üé§ –ì–û–í–û–†–ò–¢–ï –°–ï–ô–ß–ê–°"),
                  React.createElement('div', { className: "text-red-600 text-sm mt-1" }, "–ü—Ä–æ–∏–∑–Ω–æ—Å–∏—Ç–µ —á–µ—Ç–∫–æ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ")
                )
              ),

              // –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
              messages.length > 0 && React.createElement('div', { className: "bg-white rounded-lg shadow-lg p-6" },
                React.createElement('h3', { className: "font-semibold text-gray-800 mb-4" }, "–ò—Å—Ç–æ—Ä–∏—è –æ—Ç–≤–µ—Ç–æ–≤:"),
                React.createElement('div', { className: "space-y-4 max-h-60 overflow-y-auto" },
                  messages.map((msg, index) =>
                    React.createElement('div', { key: index, className: "bg-gray-50 p-4 rounded-lg border-l-4 border-blue-500" },
                      React.createElement('div', { className: "text-sm text-gray-500 mb-1" }, msg.time),
                      React.createElement('div', { className: "text-blue-800 font-medium mb-1" }, "–§—Ä–∞–∑–∞: ", msg.phrase.en),
                      React.createElement('div', { className: "text-gray-600 text-sm mb-2" }, "–ü–µ—Ä–µ–≤–æ–¥: ", msg.phrase.ru),
                      React.createElement('div', { className: "text-green-700 font-medium" }, "–í–∞—à –æ—Ç–≤–µ—Ç: ", msg.text)
                    )
                  )
                )
              ),

              // –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
              React.createElement('div', { className: "mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg" },
                React.createElement('h4', { className: "font-semibold text-yellow-800 mb-2" }, "üí° –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è:"),
                React.createElement('ul', { className: "text-yellow-700 text-sm space-y-1" },
                  React.createElement('li', null, "‚Ä¢ –ù–∞–∂–º–∏—Ç–µ üîä —á—Ç–æ–±—ã —É—Å–ª—ã—à–∞—Ç—å —Ñ—Ä–∞–∑—É"),
                  React.createElement('li', null, "‚Ä¢ –ü–æ–∫–∞–∂–∏—Ç–µ –ø–µ—Ä–µ–≤–æ–¥ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ"),
                  React.createElement('li', null, "‚Ä¢ –í–≤–µ–¥–∏—Ç–µ —Å–≤–æ–π –æ—Ç–≤–µ—Ç –≤ –ø–æ–ª–µ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω"),
                  React.createElement('li', null, "‚Ä¢ –ù–∞–∂–º–∏—Ç–µ Enter –∏–ª–∏ \"–û—Ç–ø—Ä–∞–≤–∏—Ç—å\""),
                  React.createElement('li', null, "‚Ä¢ –ü–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—É—é —Ñ—Ä–∞–∑—É –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è")
                )
              )
            )
          );
        };

        ReactDOM.render(React.createElement(EnglishSpeakApp), document.getElementById('root'));
    </script>
</body>
</html>